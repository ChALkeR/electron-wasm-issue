<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <button>Button just to check renderer responsiveness</button>
    <script>
      "use strict";
      console.log('fetch/compile started')
      const wasmBinaryFile = new URL('d3wasm.wasm', document.location.href).toString()
      fetch(wasmBinaryFile, { credentials: "same-origin" }).then(
        (response) => {
          console.log('fetch finished')
          // Can be also reproduced with instantiateStreaming
          WebAssembly.compileStreaming(response, {}).then(() => {
            console.log('compileStreaming finished, this is fine')
            window.close()
          }).catch(() => {
            console.log('compileStreaming failed, this is fine')
            window.close()
          })
        }
      );
      console.log("waiting...");
    </script>
  </body>
</html>
